CreaTe Database DANGKY
go
use DANGKY;
go
CREATE TABLE CHInHANH(
CN_id VARCHAR(10) PRIMARY KEY NOT NULL,
CN_TEN nVARCHAR(20) NOT NULL
);
CREATE TABLE SinhVien(
SV_ID VARCHAR(10) PRIMARY KEY NOT NULL,
CN_id VARCHAR(10) NOT NULL,
SV_TEN NVARCHAR(20) NOT NULL,
SV_DOB DATE  DEFAULT CONVERT (DATE, SYSDATETIME()) NOT NULL,
SV_LOPNC VARCHAR(20) NOT NULL,
FOREIGN KEY (CN_ID) REFERENCES CHINHANH(CN_ID) ON DELETE CASCADE
);
go
create table MonHoc(
MH_ID VARchar(10) primary key NOT NULL,
MH_TEN NVARCHAR(20) NOT NULL,
MH_SOTINCHI INTEGER  NOT NULL
);
go
go
CREATE TABLE DKTC(
MH_ID VARCHAR(10) NOT NULL,
SV_ID VARCHAR(10) NOT NULL,
DK_LAN INTEGER NOT NULL,
DK_GV NVARCHAR(20) NOT NULL,
DK_LOPTC VARCHAR(20) NOT NULL,
PRIMARY KEY (MH_ID, SV_ID),
FOREIGN KEY (MH_ID) REFERENCES MONHOC(MH_ID) ON DELETE CASCADE,
FOREIGN KEY (SV_ID) REFERENCES SINHVIEN(SV_ID) ON DELETE CASCADE,
--CONSTRAINT DK_UI1 UNIQUE (DK_GV and DK_LOPTC),
);
--DROP TABLE DKTC
GO
INSERT INTO MONHOC
VALUES ('BAS1201',	N'Đại số',3),
		('BAS1203',N'Giải tích 1',3),
		('BAS1224',	N'Vật lý và thí nghiệm',4),
		('INT1358',	N'Toán rời rạc',3),
		('ELE1319',N'Lý thuyết thông tin',3),
		('BAS1122',	N'Tư tưởng Hồ Chí Minh',2),
		('INT1313',	N'Cơ sở dữ liệu',3),
		('SKD1102',	N'Kỹ năng mềm',1)
GO
iNSERT INTO CHINHANH
VALUES('BH',N'HÀ NHỘI'),
	('VH',N'HỒ CHÍ MINH')
INSERT INTO SINHVIEN
VALUES ('B20DCCN410','BH', N'HÁN VĂN LUÂN','2002/01/10','LOP02'),
		('B20DCCN124','BH',N'CAO DUY HẢI','2002/11/12','LOP02'),
		('B20DCCN269','BH', N'PHAN TRỌNG KIỀU','2002/9/10','LOP02'),
		('B20DCCN925','VH', N'PHAN ANH VŨ','2002/12/12','LOP03'),
		('B20DCCN443','BH', N'ĐỖ ĐĂNG DƯƠNG','2002/01/09','LOP09'),
		('B20DCCN490','BH', N'ĐỖ ĐĂNG HẢI','2002/02/07','LOP08')
GO
INSERT INTO DKTC
VALUES ('BAS1201','B20DCCN410', 3,'GV1','LOP02'),
		('BAS1201','B20DCCN124',4,'GV3','LOP05'),
		('BAS1203','B20DCCN269',1, 'GV2','LOP04'),
		('BAS1224','B20DCCN410',1, 'GV2','LOP04'),
		('BAS1203','B20DCCN410',2, 'GV2','LOP04'),
		('BAS1203','B20DCCN443',4, 'GV6','LOP05')
-------------------
-------------------
--4.LIÊT KÊ MỌI ĐĂNG KÝ CỦA CÁC SINH VIÊN
GO
SELECT * 
FROM DKTC TC --JOIN SINHVIEN SV ON SV.SV_ID = TC.SV_ID
ORDER BY TC.SV_ID, TC.DK_LAN DESC
--5.LIỆT KÊ SINH VIÊN ĐÃ ĐĂNG KÝ TÍN CHỈ
--EXISTS
GO
SELECT *
FROM SINHVIEN SV 
WHERE EXISTS( SELECT TC.SV_ID
			FROM DKTC TC
			WHERE TC.SV_ID = SV.SV_ID)
--6.LIỆT KÊ SINH VIÊN KHÔNG ĐĂNG KÝ TÍN CHỈ
SELECT SV.SV_ID,SV.CN_id, SV.SV_TEN, SV.SV_LOPNC
FROM  SINHVIEN SV
EXCEPT 
SELECT TC.SV_ID,SV.CN_ID, SV.SV_TEN, SV.SV_LOPNC
FROM DKTC TC JOIN SINHVIEN SV ON SV.SV_ID = TC.SV_ID
----
SELECT *
FROM SINHVIEN SV 
WHERE NOT EXISTS( SELECT TC.SV_ID
			FROM DKTC TC
			WHERE TC.SV_ID = SV.SV_ID)


--7.LIỆT KÊ SINH VIÊN ĐKY MON *

SELECT *
FROM SINHVIEN SV 
WHERE EXISTS( SELECT TC.SV_ID
			FROM DKTC TC
			WHERE TC.SV_ID = SV.SV_ID and TC.MH_ID ='BAS1203')
----
go 
SELECT SV.SV_ID, SV.CN_id, SV.SV_TEN, SV.SV_DOB,SV.SV_LOPNC
FROM SINHVIEN SV ,DKTC TC, MONHOC MH
WHERE SV.SV_ID = TC.SV_ID AND MH.MH_ID=TC.MH_ID AND mh.MH_TEN =N'Giải tích 1'
---
SELECT *
FROM SINHVIEN SV 
WHERE EXISTS( SELECT TC.SV_ID
			FROM DKTC TC, MONHOC MH
			WHERE TC.SV_ID = SV.SV_ID and  MH.MH_ID=TC.MH_ID AND mh.MH_TEN =N'Giải tích 1')
----
--8.LIÊT KÊ SINH VIÊN CHỈ ĐĂNG KÝ MON *
SELECT *
FROM SINHVIEN SV 
WHERE EXISTS( SELECT TC.SV_ID
			FROM DKTC TC
			WHERE TC.SV_ID = SV.SV_ID and TC.MH_ID ='BAS1203')
EXCEPT -- TRỪ
SELECT *
FROM SINHVIEN SV 
WHERE EXISTS( SELECT TC.SV_ID
			FROM DKTC TC
			WHERE TC.SV_ID = SV.SV_ID and TC.MH_ID !='BAS1203')
----8. Thống kê số lần mỗi môn học được đăng ký
SELECT DKTC.MH_ID, COUNT(DKTC.MH_ID) AS LAN
FROM DKTC, MONHOC MH, SinhVien SV
WHERE DKTC.MH_ID = MH.MH_ID AND DKTC.SV_ID = SV.SV_ID
GROUP BY DKTC.MH_ID
--9.THỐNG KÊ NHỮNG SINH VIÊN ĐĂNG KÝ MÔN HỌC CÙNG SỐ LẦN ĐĂNG KÝ
SELECT SV.SV_ID,SV.SV_TEN, COUNT(SV.CN_id) AS LAN
FROM DKTC, MONHOC MH, SinhVien SV
WHERE DKTC.MH_ID = MH.MH_ID AND DKTC.SV_ID = SV.SV_ID
GROUP BY SV.SV_ID, SV.SV_TEN
--10.THỐNG KÊ NHỮNG SINH VIÊN CHỈ DK 1 LAN(1 MON)
SELECT DKTC.SV_ID, COUNT(DKTC.SV_ID) AS LAN
FROM DKTC, MONHOC MH, SinhVien SV
WHERE DKTC.MH_ID = MH.MH_ID AND DKTC.SV_ID = SV.SV_ID
GROUP BY DKTC.SV_ID
HAVING COUNT(DKTC.SV_ID)=1
--11.THỐNG KÊ NHỮNG SINH VIÊN CHỈ DK ĐƯỢC 1 LẦN
SELECT DKTC.MH_ID, COUNT(DKTC.MH_ID) AS LAN
FROM DKTC, MONHOC MH, SinhVien SV
WHERE DKTC.MH_ID = MH.MH_ID AND DKTC.SV_ID = SV.SV_ID
GROUP BY DKTC.MH_ID
HAVING COUNT(DKTC.MH_ID)=1
--12  sỬ TEN SV THANH IN HOA

SELECT UPPER(SV.SV_TEN)
FROM SINHVIEN SV

--13 THEM THUOC TÍNH "GT" VÀO SINHVIEN
ALTER TABLE SINHVIEN ADD GT NVARCHAR(20)
--14 SỬ THUOC TÍNH "GT" THÀNH CHAR
ALTER TABLE SINHVIEN ALTER COLUMN GT CHAR(3)
ALTER TABLE SINHVIEN DROP COLUMN GT